# 🐍 Python Sandbox API

[![Live Demo](https://img.shields.io/badge/Live_Demo-Online-brightgreen?style=for-the-badge&logo=render)](https://python-exeution.onrender.com)
[![Language](https://img.shields.io/badge/Language-Python-blue?style=for-the-badge&logo=python)](https://www.python.org/)

A secure, versatile, and sandboxed Python code execution service exposed via a simple RESTful API. This project allows you to safely execute untrusted Python code in an isolated environment, complete with support for file attachments, standard input, and retrieving output files.

---

## ✨ Live Demo

This application is deployed and live on Render. You can start making requests immediately to the base URL:

**`https://python-exeution.onrender.com`**

The documentation and a user-friendly interface are available at the base URL.

> **Note:** The public API is open to everyone but is rate-limited to ensure fair usage and server stability. Please see the [Limits & Restrictions](#-limits--restrictions) section for more details.

## 🚀 Features

-   **Secure Sandboxing**: Code is executed in an isolated, temporary environment with no network access and restricted filesystem permissions.
-   **File I/O**: Attach files to your request, process them in your script, and retrieve generated output files.
-   **Resource Limiting**: Strict limits on execution time, code length, and process creation prevent abuse and infinite loops.
-   **Curated Libraries**: Access a safe, curated list of popular libraries like `numpy` and `Pillow`, while blocking dangerous modules like `os` or `subprocess`.
-   **Rate Limiting**: Per-IP rate limiting and daily quotas to prevent spam and ensure fair usage.
-   **Concurrency Control**: The server actively manages load, returning a `503 Service Busy` error if too many processes are running concurrently.

## 🛡️ Security Model

Security is the primary design goal. Every execution is constrained by:
-   **No Network Access**: Scripts are blocked from making any outbound network calls.
-   **Filesystem Isolation**: Code runs within a temporary directory that is permanently deleted after execution. It has no access to the host filesystem.
-   **Import Restrictions**: An allowlist of safe modules prevents the use of potentially harmful libraries.
-   **Process Limits**: Protection against "fork bombs" by limiting the number of child processes a script can create.
-   **Ephemeral Environment**: The entire execution context is destroyed after each API call, ensuring no data persists between requests.

## 📋 API Documentation

### Endpoint: `POST /execute`

Executes the provided Python code in a sandboxed environment.

#### Request Body Schema

| Field            | Type              | Required | Description                                                                                             |
| ---------------- | ----------------- | -------- | ------------------------------------------------------------------------------------------------------- |
| `code`           | String            | **Yes**  | The Python code to execute (max **2000 characters**).                                                   |
| `stdin_data`     | String            | No       | Text data to be passed to the script's standard input.                                                  |
| `attachments`    | Array of Objects  | No       | Files to be made available to the script. Max **2 files**, **8MB** each. See object schema below.         |
| `return_files`   | Array of Strings  | No       | A list of filenames generated by the script that you want returned in the response.                     |

**Attachment Object Schema:**
-   `filename` (String): The name of the file as it will appear in the execution directory.
-   `content_base_64` (String): The file content, encoded in Base64.

---

### ✅ Successful Response (`200 OK`)

```json
{
  "status": "success",
  "timestamp_utc": "2023-10-28T12:00:00.123456+00:00",
  "execution_details": {
    "stdout": "Hello from the sandbox!\n",
    "stderr": "",
    "exit_code": 0,
    "execution_duration_sec": 0.0123,
    "output_files": {
      "output.txt": "VGhpcyBpcyB0aGUgY29udGVudCBvZiB0aGUgb3V0cHV0IGZpbGUu"
    }
  }
}
```

### ❌ Error Response

Errors are returned with an appropriate HTTP status code (e.g., `400`, `429`, `503`).

```json
{
  "status": "error",
  "timestamp_utc": "2023-10-28T12:01:00.123456+00:00",
  "error_details": {
    "type": "ForbiddenImportError",
    "message": "Disallowed imports: os."
  }
}
```

| Status Code | Error Type           | Reason                                                               |
| ----------- | -------------------- | -------------------------------------------------------------------- |
| `400`       | `ValidationError`    | Request JSON is malformed, a file is too large, etc.                 |
| `400`       | `ForbiddenImportError` | The script attempts to import a disallowed module.                   |
| `400`       | `TimeoutError`       | Execution exceeded the 10-second time limit.                         |
| `429`       | `RateLimitExceeded`  | The per-minute or daily request limit has been reached.              |
| `503`       | `ServerBusy`         | The server has reached its maximum concurrent execution limit.       |

---

## ⚖️ Limits & Restrictions

To ensure stability and security, the following limits are enforced:

| Category        | Limit                | Description                                                          |
| --------------- | -------------------- | -------------------------------------------------------------------- |
| **Rate Limits** | 5 RPM / 30 RPD       | Requests per minute / Requests per day, per IP address.              |
|                 | 5 Concurrent Jobs    | Max simultaneous executions server-wide.                             |
| **Resources**   | 10 seconds           | Maximum execution time per script.                                   |
|                 | 2000 chars           | Maximum length of the `code` field.                                  |
|                 | 10 child processes   | Protection against fork bombs.                                       |
| **Files**       | 2 attachments        | Maximum number of files that can be uploaded in one request.         |
|                 | 8 MB per file        | Maximum size for each attached or returned file.                     |

---

## 📚 Allowed Libraries

A curated list of standard and third-party libraries is available. Any import not on this list will be rejected.

| Category                      | Allowed Modules                                                              |
| ----------------------------- | ---------------------------------------------------------------------------- |
| **Key Third-Party**           | `numpy`                                                                      |
| **Media & Document Gen**      | `PIL (Pillow)`, `reportlab`, `fpdf`                                          |
| **Data, Math & Time**         | `math`, `statistics`, `decimal`, `random`, `datetime`, `time`                |
| **Text, Regex & Data**        | `string`, `re`, `textwrap`, `json`, `ast`, `base64`, `hashlib`                |
| **Data Structures & Utils**   | `collections`, `itertools`, `functools`, `operator`, `copy`, `pprint`        |

---

## 💻 Usage Examples

### Simple cURL Request

```bash
curl -X POST https://python-exeution.onrender.com/execute \
-H "Content-Type: application/json" \
-d '{
  "code": "print(\"Hello from the sandbox!\")"
}'
```

### Advanced Example: Image Grayscaling with Python

This example uploads an image, uses the **Pillow** library to convert it to grayscale, and returns the processed image.

#### 1. The Sandbox Script (sent in the `code` field)
```python
from PIL import Image

try:
    # 'input_photo.jpg' is the filename we specify in the attachment
    with Image.open('input_photo.jpg') as img:
        grayscale_img = img.convert('L')
        # This is the file we ask the API to return
        grayscale_img.save('output_grayscale.png')
        print("Image successfully converted to grayscale.")
except Exception as e:
    print(f"An unexpected error occurred: {e}")
```

#### 2. The Client-Side Request Script (run locally)
```python
import requests
import base64
import json

API_URL = 'https://python-exeution.onrender.com/execute'
LOCAL_IMAGE_PATH = 'my_photo.jpg' # Make sure this file exists locally
RESULT_IMAGE_PATH = 'result_grayscale.png'

# 1. Read local image and Base64 encode it
with open(LOCAL_IMAGE_PATH, "rb") as image_file:
    b64_content = base64.b64encode(image_file.read()).decode('utf-8')

# 2. Construct the API payload
payload = {
    "code": sandbox_code, # The script from step 1
    "attachments": [{
        "filename": "input_photo.jpg",
        "content_base_64": b64_content
    }],
    "return_files": ["output_grayscale.png"]
}

# 3. Send the request
response = requests.post(API_URL, json=payload)

# 4. Process the response
if response.status_code == 200:
    data = response.json()['execution_details']
    print("API Call Successful!")
    print(f"  > Stdout: {data.get('stdout', '').strip()}")
    
    output_files = data.get('output_files', {})
    if 'output_grayscale.png' in output_files:
        grayscale_data = base64.b64decode(output_files['output_grayscale.png'])
        with open(RESULT_IMAGE_PATH, "wb") as f:
            f.write(grayscale_data)
        print(f"> Success! Grayscale image saved to '{RESULT_IMAGE_PATH}'")
else:
    print(f"API Error: {response.status_code}")
    print(json.dumps(response.json(), indent=2))
```

---

## 🔧 Local Development & Deployment

### Prerequisites
-   Python 3.8+
-   `pip` and `venv`

### Installation
1.  **Clone the repository:**
    ```bash
    git clone https://github.com/your-username/python-sandbox-api.git
    cd python-sandbox-api
    ```

2.  **Create and activate a virtual environment:**
    ```bash
    # For Unix/macOS
    python3 -m venv venv
    source venv/bin/activate

    # For Windows
    python -m venv venv
    .\venv\Scripts\activate
    ```

3.  **Install dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

### Configuration
For admin access (bypassing rate limits and import restrictions), set the `PYTHON_EXE_KEY` environment variable.

```bash
# For Unix/macOS
export PYTHON_EXE_KEY="your-secret-api-key"

# For Windows
set PYTHON_EXE_KEY="your-secret-api-key"
```

### Running the Server
```bash
python app.py
```
The server will start on `http://127.0.0.1:5000`.

## 🤝 Contributing

Contributions, issues, and feature requests are welcome! Feel free to check the [issues page](https://github.com/Bhargavxyz738/Python-exeution/issues).

## 📄 License

This project is licensed under the MIT License.

## 👨‍💻 Developed By

-   **Bhargav** - [Bhargavxyz738](https://github.com/Bhargavxyz738)
